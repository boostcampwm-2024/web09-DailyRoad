import { useStore } from '@/store/useStore';
import { useEffect, useState } from 'react';

type MarkerEventProps = {
  onClick?: (e: google.maps.MapMouseEvent) => void;
};

export type MarkerProps = Omit<
  google.maps.marker.AdvancedMarkerElementOptions,
  'map'
> &
  MarkerEventProps;

export const useMarker = (props: MarkerProps) => {
  const [marker, setMarker] =
    useState<google.maps.marker.AdvancedMarkerElement | null>(null);
  const map = useStore((state) => state.googleMap);

  const { onClick, ...markerOptions } = props;
  useEffect(() => {
    if (!map) {
      return;
    }
    const contentDiv = document.createElement('div');
    contentDiv.innerHTML = `<svg width="24" height="24" viewBox="0 0 235 235" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="235" height="235" rx="44.7619" fill="#858899"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M94.5743 112.955C94.5743 108.565 97.7517 104.915 101.426 102.513C108.096 98.1534 112.566 90.1401 112.566 80.9763C112.566 67.1564 102.398 55.9531 89.8554 55.9531C77.3125 55.9531 67.1445 67.1564 67.1445 80.9763C67.1445 90.1391 71.6143 98.1516 78.2824 102.511C81.956 104.913 85.1323 108.563 85.1323 112.952V179.92C85.1323 182.528 87.246 184.641 89.8533 184.641C92.4607 184.641 94.5743 182.528 94.5743 179.92V112.955ZM130.736 55.9531C128.128 55.9531 126.015 58.0668 126.015 60.6741V87.8307C126.015 96.1478 130.451 103.429 137.086 107.437C140.91 109.748 144.188 113.435 144.188 117.903V179.923C144.188 182.53 146.302 184.644 148.909 184.644C151.517 184.644 153.63 182.53 153.63 179.923V117.898C153.63 113.431 156.906 109.745 160.729 107.434C167.361 103.425 171.794 96.1455 171.794 87.8307V60.6741C171.794 58.0668 169.68 55.9531 167.073 55.9531C164.466 55.9531 162.352 58.0668 162.352 60.6741V87.8307C162.352 88.7379 162.262 89.6241 162.091 90.4808C160.799 96.9469 153.63 93.3883 153.63 86.7944V60.6741C153.63 58.0668 151.517 55.9531 148.909 55.9531C146.302 55.9531 144.188 58.0668 144.188 60.6741V86.8094C144.188 93.4002 137.024 96.9631 135.722 90.5022C135.548 89.6388 135.457 88.7454 135.457 87.8307V60.6741C135.457 58.0668 133.343 55.9531 130.736 55.9531Z" fill="white"/>
<path d="M135.722 90.5022L134.351 90.7786L135.722 90.5022ZM162.091 90.4808L163.463 90.755L162.091 90.4808ZM137.086 107.437L136.362 108.634L137.086 107.437ZM78.2824 102.511L77.517 103.682L78.2824 102.511ZM160.729 107.434L160.005 106.237L160.729 107.434ZM111.168 80.9763C111.168 89.6891 106.918 97.2523 100.661 101.342L102.191 103.684C109.274 99.0546 113.965 90.5911 113.965 80.9763H111.168ZM89.8554 57.3519C101.501 57.3519 111.168 67.7982 111.168 80.9763H113.965C113.965 66.5145 103.295 54.5543 89.8554 54.5543V57.3519ZM68.5433 80.9763C68.5433 67.7982 78.2096 57.3519 89.8554 57.3519V54.5543C76.4155 54.5543 65.7457 66.5145 65.7457 80.9763H68.5433ZM79.0479 101.341C72.7923 97.2506 68.5433 89.6881 68.5433 80.9763H65.7457C65.7457 90.59 70.4362 99.0527 77.517 103.682L79.0479 101.341ZM86.5312 179.92V112.952H83.7335V179.92H86.5312ZM93.1755 112.955V179.92H95.9731V112.955H93.1755ZM127.414 87.8307V60.6741H124.616V87.8307H127.414ZM137.809 106.24C131.576 102.474 127.414 95.6379 127.414 87.8307H124.616C124.616 96.6577 129.325 104.383 136.362 108.634L137.809 106.24ZM145.587 179.923V117.903H142.79V179.923H145.587ZM152.231 117.898V179.923H155.029V117.898H152.231ZM170.395 87.8307C170.395 95.6357 166.236 102.47 160.005 106.237L161.453 108.631C168.486 104.379 173.193 96.6552 173.193 87.8307H170.395ZM170.395 60.6741V87.8307H173.193V60.6741H170.395ZM163.751 87.8307V60.6741H160.953V87.8307H163.751ZM163.463 90.755C163.652 89.8084 163.751 88.8304 163.751 87.8307H160.953C160.953 88.6453 160.873 89.4397 160.719 90.2067L163.463 90.755ZM152.231 60.6741V86.7944H155.029V60.6741H152.231ZM145.587 86.8094V60.6741H142.79V86.8094H145.587ZM134.058 87.8307C134.058 88.8388 134.159 89.8247 134.351 90.7786L137.093 90.2259C136.938 89.4529 136.856 88.6521 136.856 87.8307H134.058ZM134.058 60.6741V87.8307H136.856V60.6741H134.058ZM136.856 60.6741C136.856 57.2942 134.116 54.5543 130.736 54.5543V57.3519C132.571 57.3519 134.058 58.8393 134.058 60.6741H136.856ZM142.79 86.8094C142.79 89.6287 141.255 91.6312 139.855 92.2814C139.175 92.5969 138.641 92.5578 138.27 92.353C137.891 92.1441 137.368 91.5895 137.093 90.2259L134.351 90.7786C134.727 92.6454 135.588 94.0683 136.919 94.8025C138.257 95.5408 139.758 95.4105 141.033 94.819C143.539 93.6553 145.587 90.5809 145.587 86.8094H142.79ZM148.909 54.5543C145.529 54.5543 142.79 57.2942 142.79 60.6741H145.587C145.587 58.8393 147.075 57.3519 148.909 57.3519V54.5543ZM155.029 60.6741C155.029 57.2942 152.289 54.5543 148.909 54.5543V57.3519C150.744 57.3519 152.231 58.8393 152.231 60.6741H155.029ZM160.719 90.2067C160.447 91.5719 159.924 92.1271 159.546 92.3362C159.176 92.5411 158.644 92.5809 157.964 92.266C156.564 91.617 155.029 89.6152 155.029 86.7944H152.231C152.231 90.5675 154.281 93.6419 156.788 94.8042C158.062 95.395 159.564 95.5242 160.901 94.7838C162.231 94.0475 163.089 92.6228 163.463 90.755L160.719 90.2067ZM173.193 60.6741C173.193 57.2942 170.453 54.5543 167.073 54.5543V57.3519C168.908 57.3519 170.395 58.8393 170.395 60.6741H173.193ZM148.909 186.042C152.289 186.042 155.029 183.302 155.029 179.923H152.231C152.231 181.757 150.744 183.245 148.909 183.245V186.042ZM142.79 179.923C142.79 183.302 145.529 186.042 148.909 186.042V183.245C147.075 183.245 145.587 181.757 145.587 179.923H142.79ZM136.362 108.634C140.009 110.837 142.79 114.152 142.79 117.903H145.587C145.587 112.717 141.812 108.658 137.809 106.24L136.362 108.634ZM127.414 60.6741C127.414 58.8393 128.901 57.3519 130.736 57.3519V54.5543C127.356 54.5543 124.616 57.2942 124.616 60.6741H127.414ZM83.7335 179.92C83.7335 183.3 86.4735 186.04 89.8533 186.04V183.242C88.0185 183.242 86.5312 181.755 86.5312 179.92H83.7335ZM167.073 54.5543C163.693 54.5543 160.953 57.2942 160.953 60.6741H163.751C163.751 58.8393 165.238 57.3519 167.073 57.3519V54.5543ZM77.517 103.682C81.0369 105.984 83.7335 109.265 83.7335 112.952H86.5312C86.5312 107.861 82.875 103.843 79.0479 101.341L77.517 103.682ZM89.8533 186.04C93.2332 186.04 95.9731 183.3 95.9731 179.92H93.1755C93.1755 181.755 91.6881 183.242 89.8533 183.242V186.04ZM155.029 117.898C155.029 114.148 157.808 110.834 161.453 108.631L160.005 106.237C156.004 108.655 152.231 112.713 152.231 117.898H155.029ZM100.661 101.342C96.8328 103.844 93.1755 107.863 93.1755 112.955H95.9731C95.9731 109.267 98.6706 105.985 102.191 103.684L100.661 101.342Z" fill="white"/>
</svg>
`;
    contentDiv.style.borderRadius = '50%';
    contentDiv.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.3)';
    const newMarker = new google.maps.marker.AdvancedMarkerElement({
      ...markerOptions,
      content: contentDiv,
    });
    newMarker.map = map;
    setMarker(newMarker);

    return () => {
      newMarker.map = null;
      setMarker(null);
    };
  }, [map]);

  useEffect(() => {
    if (!marker) return;

    if (onClick) {
      google.maps.event.addListener(marker, 'click', onClick);
    }

    return () => {
      google.maps.event.clearInstanceListeners(marker);
    };
  }, [marker, onClick]);
  return marker;
};
